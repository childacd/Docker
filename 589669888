å¥½çš„ï¼Œä¸‹é¢æ˜¯åŠ å…¥è·¯å¾„åŠ¨æ€åˆ¤æ–­åŠŸèƒ½åçš„å®Œæ•´æ ¸å¿ƒä»£ç ï¼š

âœ… åŠ¨æ€åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹çš„å…¬å…±å‡½æ•°

ï¼ˆå»ºè®®æ”¾åœ¨ utils.pyï¼‰

import subprocess
from logger import logger

def is_folder_cli(storage_type, bucket, path):
    """
    åˆ¤æ–­è·¯å¾„æ˜¯å¦ä¸ºç›®å½•ï¼š
    1. å¦‚æœè·¯å¾„ä»¥ '/' ç»“å°¾ï¼Œç›´æ¥è®¤å®šä¸ºç›®å½•ã€‚
    2. å¦åˆ™ï¼Œå°è¯•åˆ—å‡ºè¯¥è·¯å¾„ä¸‹çš„å¯¹è±¡ï¼Œè‹¥æœ‰è¿”å›åˆ™è®¤å®šä¸ºç›®å½•ã€‚
    """
    if path.endswith('/'):
        return True

    if storage_type == 's3':
        cmd = f"aws s3 ls s3://{bucket}/{path}/"
    else:
        cmd = f"mc ls minio/{bucket}/{path}/"

    logger.debug(f"Executing folder check: {cmd}")
    result = subprocess.run(cmd, shell=True, capture_output=True, text=True)

    is_folder = bool(result.stdout.strip())
    logger.debug(f"Folder check result for {storage_type}://{bucket}/{path} -> {is_folder}")

    return is_folder

âœ… S3 Wrapperï¼ˆåŠ åŠ¨æ€åˆ¤æ–­ï¼‰

import subprocess
from logger import logger
from utils import is_folder_cli

def s3_copy(bucket, key, local_path, download=True):
    is_folder = is_folder_cli('s3', bucket, key)
    recursive_flag = " --recursive" if is_folder else ""

    if download:
        cmd = f"aws s3 cp s3://{bucket}/{key} {local_path}{recursive_flag}"
        logger.info(f"Downloading from S3: {cmd}")
    else:
        cmd = f"aws s3 cp {local_path} s3://{bucket}/{key}{recursive_flag}"
        logger.info(f"Uploading to S3: {cmd}")

    subprocess.run(cmd, shell=True, check=True)

def s3_list(bucket, prefix):
    cmd = f"aws s3 ls s3://{bucket}/{prefix}"
    logger.info(f"Listing S3 objects: {cmd}")

    result = subprocess.run(cmd, shell=True, check=True, capture_output=True, text=True)
    return [line for line in result.stdout.strip().split("\n") if line]

âœ… MinIO Wrapperï¼ˆåŠ åŠ¨æ€åˆ¤æ–­ï¼‰

import subprocess
from logger import logger
from utils import is_folder_cli

def minio_copy(bucket, key, local_path, download=True):
    is_folder = is_folder_cli('minio', bucket, key)
    recursive_flag = " --recursive" if is_folder else ""

    if download:
        cmd = f"mc cp{recursive_flag} minio/{bucket}/{key} {local_path}"
        logger.info(f"Downloading from MinIO: {cmd}")
    else:
        cmd = f"mc cp{recursive_flag} {local_path} minio/{bucket}/{key}"
        logger.info(f"Uploading to MinIO: {cmd}")

    subprocess.run(cmd, shell=True, check=True)

def minio_list(bucket, prefix):
    cmd = f"mc ls minio/{bucket}/{prefix}"
    logger.info(f"Listing MinIO objects: {cmd}")

    result = subprocess.run(cmd, shell=True, check=True, capture_output=True, text=True)
    return [line for line in result.stdout.strip().split("\n") if line]

âœ… è¯´æ˜

åœºæ™¯	è¡Œä¸º
ç”¨æˆ·è·¯å¾„ä»¥ / ç»“å°¾	ç›´æ¥è®¤å®šä¸ºç›®å½•ï¼ŒåŠ  --recursive
ç”¨æˆ·è·¯å¾„ä¸å¸¦ /	æ‰§è¡Œ CLI æ£€æŸ¥ï¼Œæ˜¯å¦å­˜åœ¨ä¸‹å±‚å¯¹è±¡ï¼Œè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦åŠ  --recursive

å¦‚æœä½ éœ€è¦ï¼š
	â€¢	æ•´ä¸ªé¡¹ç›®çš„å‹ç¼©åŒ… âœ…
	â€¢	ä½¿ç”¨æ–‡æ¡£ âœ…
	â€¢	Docker é•œåƒéƒ¨ç½²æŒ‡å¯¼ âœ…

éšæ—¶å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ ä¸€é”®æ‰“åŒ…ï¼éœ€è¦æˆ‘ç°åœ¨å¸®ä½ ç”Ÿæˆå—ï¼ŸğŸ˜Š
