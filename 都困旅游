å°±ä½ ç°åœ¨è¿™ä¸ªä¸»ç¨‹åºæ¥çœ‹ï¼Œå¦‚æœä½ åªæƒ³â€œæœ€å°æ”¹åŠ¨â€ï¼Œä¸æƒ³å¼•å…¥æ–°ä¾èµ–ã€ä¸æƒ³é‡æ„è°ƒåº¦å™¨é€»è¾‘ï¼Œé‚£ç­”æ¡ˆæ˜¯ï¼š

ğŸ‘‰ æ–¹æ¡ˆ Bï¼šä¿¡å·è§¦å‘ï¼ˆæœ€å°ã€æœ€æ–¹ä¾¿ï¼‰

åªéœ€è¦åŠ å‡ è¡Œä»£ç å°±èƒ½å®ç°ï¼Œä¸éœ€è¦æ–°å¼€ HTTP ç«¯å£ã€ä¹Ÿä¸éœ€è¦å¼•ç¬¬ä¸‰æ–¹åº“ï¼š

import signal

def run_minio_folder_sync(dremio_config):
    metrics = PrometheusMetrics()
    scheduler = JobScheduler(dremio_config, metrics, fetch_interval)

    # ç»™ scheduler åŠ ä¸€ä¸ªç«‹åˆ»æ‰§è¡Œçš„æ–¹æ³•ï¼ˆå‡è®¾ä½ å·²ç»æœ‰ sync_onceï¼‰
    def trigger_handler(signum, frame):
        try:
            logging.info("Received trigger signal, running once...")
            scheduler.sync_once()
        except Exception:
            logging.exception("Manual trigger failed")

    # ç»‘å®šåˆ° SIGUSR1 ä¿¡å·
    signal.signal(signal.SIGUSR1, trigger_handler)

    try:
        logging.info(f'Starting prometheus http_server on port {http_port}')
        start_http_server(http_port)
    except Exception as e:
        logging.error('Error starting http_server for prometheus')
        logging.error(e)
        sys.exit(1)

    scheduler.start()

    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        logging.warning('\nShutting down scheduler...')
        scheduler.stop()
        scheduler.join()

è§¦å‘æ–¹æ³•ï¼š

# æ‰¾åˆ°è¿›ç¨‹ PID
ps aux | grep python

# å‘é€ä¿¡å·è§¦å‘ç«‹å³æ‰§è¡Œ
kill -USR1 <pid>

è¿™æ ·æ”¹åŠ¨æœ€å°ï¼š
	â€¢	åªåŠ äº†ä¸€ä¸ª signal.signal å’Œä¸€ä¸ª handlerã€‚
	â€¢	ä¸éœ€è¦å¼€é¢å¤– HTTP æœåŠ¡ï¼Œä¸éœ€è¦æ–°çº¿ç¨‹ã€‚
	â€¢	Linux/macOS ä¸Šç›´æ¥ç”¨ kill -USR1 å°±èƒ½è§¦å‘ã€‚

è¦ä¸è¦æˆ‘å¸®ä½ æŠŠ JobScheduler é‡Œçš„ sync_once() ç¤ºä¾‹æ–¹æ³•å†™å‡ºæ¥ï¼ˆæ¯”å¦‚ç›´æ¥è°ƒç”¨ä¸€æ¬¡ fetch é€»è¾‘ï¼‰ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´è·‘ï¼Ÿ
