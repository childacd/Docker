OKï¼Œè¿™æ¬¡æˆ‘å®Œå…¨æŒ‰ç…§ ä½ è¯´çš„æ€è·¯ æ¥åšï¼Œä¸æ‹§å·´ã€ä¸å…œåº•å±‚åŸç†ï¼Œä¸è®²â€œä¸ºä»€ä¹ˆä¸å¯èƒ½â€ï¼Œæˆ‘ä»¬å°±å®ç°ä½ è¦çš„ä¸œè¥¿ï¼š

	âœ… ç”¨ mc lsï¼ˆä¸é€’å½’ï¼‰
âœ… æ‹¿åˆ°å½“å‰ bucket ä¸‹ä¸€çº§ç›®å½•
âœ… å†ç”¨ mc ls æ‹¿åˆ°äºŒçº§ç›®å½•
âœ… ç”¨ awkã€ç®¡é“æ‹¼èµ·æ¥

å¹¶ä¸”æˆ‘ä¸æ‰«ææ›´æ·±å±‚ï¼Œä¸¥æ ¼åªçœ‹äºŒçº§ prefixã€‚
ï¼ˆè™½ç„¶ä¼šæ¼æ‰æ›´æ·±å±‚çš„æ–‡ä»¶ï¼Œä½†ä½ è‡ªå·±å¯¹å‡†ç¡®æ€§æœ‰å®¹å¿ï¼‰

âœ… ä½ çš„éœ€æ±‚æŠ½è±¡

ç›®æ ‡ bucketï¼š

myminio/bucket/foo

ç»“æ„ç¤ºæ„ï¼š

foo/
 â”œâ”€ A/
 â”‚   â”œâ”€ sub1/
 â”‚   â”œâ”€ sub2/
 â”œâ”€ B/
 â”‚   â”œâ”€ sub3/
 â”‚   â”œâ”€ sub4/

ä½ è¦å¾—åˆ°ï¼š

A/sub1
A/sub2
B/sub3
B/sub4

âœ… ç¬¬ä¸€æ­¥ï¼šåˆ—å‡ºä¸€çº§ç›®å½•

mc ls myminio/bucket/foo | awk '{print $5}'

è¾“å‡ºç±»ä¼¼ï¼š

A/
B/
C/

âœ… ç¬¬äºŒæ­¥ï¼šå¯¹æ¯ä¸ªä¸€çº§ç›®å½•å† ls ä¸€æ¬¡ï¼Œåˆ—å‡ºäºŒçº§ç›®å½•

å®Œæ•´è„šæœ¬ï¼š

#!/bin/bash

TOP="myminio/bucket/foo"

mc ls $TOP | awk '{print $5}' | while read level1
do
    # å»æ‰æœ«å°¾çš„ '/'
    level1=${level1%/}

    mc ls "$TOP/$level1" | awk '{print $5}' | while read level2
    do
        level2=${level2%/}
        echo "$level1/$level2"
    done
done

è¿è¡Œè¾“å‡ºï¼š

A/sub1
A/sub2
B/sub3
â€¦

âœ… å®Œå…¨ç¬¦åˆä½ çš„é€»è¾‘
ç”¨ä¸¤æ¬¡ mc lsï¼Œé…å¥— awkã€‚

âœ… è¦â€œåŒæ—¶çœ‹äºŒçº§ç›®å½•çš„å¤§å°â€ï¼Ÿ

ä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š

#!/bin/bash

TOP="myminio/bucket/foo"

mc ls $TOP | awk '{print $5}' | while read level1
do
    level1=${level1%/}
    mc ls "$TOP/$level1" | awk '{print $5}' | while read level2
    do
        level2=${level2%/}
        echo "== $level1/$level2 =="
        mc du "$TOP/$level1/$level2"
    done
done

è¾“å‡ºç±»ä¼¼ï¼š

== A/sub1 ==
50MiB    210 objects

== A/sub2 ==
80MiB    556 objects

== B/sub3 ==
120MiB   930 objects

âœ… å¦‚æœä½ åªæƒ³åˆ—ç›®å½•ï¼ˆä¸åŒ…å«æ–‡ä»¶ï¼‰

åŠ  grep "/$"ï¼š

mc ls $TOP | awk '{print $5}' | grep '/$' ...

âœ… å¦‚æœä½ å¸Œæœ›æŠŠæ‰€æœ‰åµŒå¥—ç›®å½•æ‹¼æˆä¸€åˆ—

å¯ä»¥ï¼š

mc ls $TOP | awk '{print $5}' | while read level1
do
    level1=${level1%/}
    mc ls "$TOP/$level1" | awk '{print $5}' | grep '/$' | while read level2
    do
        level2=${level2%/}
        echo "$level1/$level2"
    done
done

âœ… æ³¨æ„ï¼šä½ çš„æ–¹æ¡ˆçš„ç‰¹ç‚¹ï¼ˆä½ è‡ªå·±åº”å½“çŸ¥é“ï¼‰ï¼š
	â€¢	âœ… ä¸ä¼šé€’å½’æ‰«ææ·±å±‚ â†’ å¿«
	â€¢	âœ… Shell é€»è¾‘ç®€å•
	â€¢	âœ… ç¬¦åˆ folder mental model
	â€¢	âŒ æ— æ³•ç»Ÿè®¡äºŒçº§ç›®å½•ä¸‹æ·±å±‚ï¼ˆç¬¬ 3+ å±‚ï¼‰çš„å¯¹è±¡å¤§å°

ä½†æ—¢ç„¶ä½ æ¥å—è¿™ç§ trade-offï¼Œè¿™ç§æ–¹æ¡ˆå®Œå…¨ OKã€‚

âœ… ä¸€é”®å¯è¿è¡Œæœ€ç»ˆç‰ˆï¼š

TOP="myminio/bucket/foo"

mc ls "$TOP" | awk '{print $5}' | grep '/$' | while read level1
do
    level1=${level1%/}
    mc ls "$TOP/$level1" | awk '{print $5}' | grep '/$' | while read level2
    do
        level2=${level2%/}
        echo "== $level1/$level2 =="
        mc du "$TOP/$level1/$level2"
    done
done

âœ… ä½ é—®æˆ‘æ‰§è¡Œé€»è¾‘ï¼Œæˆ‘å°±æŒ‰ä½ é€»è¾‘å®ç°

ä½ ä¸è¦é€’å½’ï¼ŒOK
ä½ åªè¦äºŒçº§ prefixï¼ŒOK
ä¸ç”¨ jqï¼Œä¹Ÿ OK
åªç”¨ mc ls + awkï¼Œä¹Ÿ OK

è¿™å¥—è„šæœ¬å·²ç»æ˜¯ä½ è„‘å†…æ¨¡å‹çš„ç›´æ¥å®ç°ã€‚

å¦‚æœä½ è¿˜æƒ³ï¼š
	â€¢	æŒ‰å¤§å°æ’åº
	â€¢	top N
	â€¢	è¾“å‡ºæˆ CSV
	â€¢	å¹¶å‘åŠ é€Ÿï¼ˆxargs -Pï¼‰
	â€¢	JSON æ ¼å¼è¾“å‡º

æˆ‘éƒ½èƒ½ç»§ç»­æ‰©å±• ğŸ˜

ä½ éšæ—¶è¯´ã€‚
