å½“ç„¶å¯ä»¥ï¼ŒServiceNow çš„ work_notes å’Œ comments å­—æ®µæ˜¯ å®Œå…¨æ”¯æŒæ¢è¡Œï¼ˆ\nï¼‰ çš„ï¼Œåªè¦ä½ æŠŠå­—ç¬¦ä¸²å†…å®¹å†™è¿›å»ï¼ŒServiceNow ä¼šæ­£ç¡®ä¿ç•™æ ¼å¼ã€‚

ä¸‹é¢æˆ‘æŠŠæ¢è¡Œç‰ˆæœ¬çš„å†™æ³•ç»™ä½ ï¼Œç¡®ä¿ä½ å¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ã€‚

âœ… æœ€ä½³å®è·µï¼šç”¨ä¸‰å¼•å·ç”Ÿæˆå¤šè¡Œ comment

ä¾‹å¦‚ä½ çš„ SQL ç”Ÿæˆç»“æœæ”¾åœ¨ sql_output å˜é‡é‡Œï¼š

comment_text = f"""Generated SQL:

{sql_output}

-- End of auto-generated SQL --
"""

è¿™æ ·å¾—åˆ°çš„æ˜¯æ˜ç¡®å¤šè¡Œã€æœ‰ç©ºè¡Œã€æ ¼å¼æ¸…æ™°çš„å†…å®¹ã€‚

âœ¨ å¸¦æ¢è¡Œçš„å®Œæ•´å‡½æ•°ï¼ˆä½ ç›´æ¥ç”¨ï¼‰

import requests

def add_comment_to_ritm(sys_id, sql_text, instance, username, password):
    comment_text = f"""Auto-generated SQL:

{sql_text}

-- End of SQL --
"""

    url = f"https://{instance}/api/now/table/sc_req_item/{sys_id}"

    payload = {
        "work_notes": comment_text   # Fully supports multi-line text
    }

    response = requests.patch(
        url,
        auth=(username, password),
        json=payload,
        headers={"Content-Type": "application/json"},
        verify=False
    )

    if response.status_code not in (200, 201):
        print("[âŒ Failed to add comment]", response.status_code, response.text)
    else:
        print("[âœ… Comment added to RITM]", sys_id)

ç¤ºä¾‹è°ƒç”¨

sql_output = "SELECT * FROM my_table WHERE id = 123;"
add_comment_to_ritm(sys_id, sql_output, INSTANCE, USERNAME, PASSWORD)

ServiceNow é‡Œçœ‹åˆ°çš„æ•ˆæœä¼šæ˜¯ï¼š

Auto-generated SQL:

SELECT * FROM my_table WHERE id = 123;

-- End of SQL --

âœ” ä½ ä¹Ÿå¯ä»¥æ·»åŠ æ›´æ¼‚äº®çš„æ ¼å¼ï¼ˆæ¯”å¦‚ JSON / SQL é«˜äº®é£æ ¼ï¼‰

ä¾‹å¦‚ï¼š

==== AUTO-GENERATED SQL START ====

SELECT ...
FROM ...
WHERE ...

==== END ====

ä½ å¯ä»¥è¿™æ ·å†™ï¼š

comment_text = (
    "==== AUTO-GENERATED SQL START ====\n\n"
    f"{sql_output}\n\n"
    "==== END ====\n"
)

ServiceNow ä¼šç™¾åˆ†ç™¾æŒ‰æ ¼å¼å‘ˆç°ã€‚

ğŸ’¡ æƒ³è®©æˆ‘å¸®ä½ ä¼˜åŒ– Comment çš„æ ¼å¼å—ï¼Ÿ

ä¾‹å¦‚ï¼š
	â€¢	è‡ªåŠ¨åŠ  timestamp
	â€¢	è‡ªåŠ¨åŠ æ‰§è¡Œäºº
	â€¢	è‡ªåŠ¨åŠ  worker è„šæœ¬è¾“å‡ºçš„ç»“æœ
	â€¢	è‡ªåŠ¨æ ‡æ³¨ SQL æ˜¯å¦æˆåŠŸ
	â€¢	è‡ªåŠ¨åŠ è£…é¥°æ¡†

åªè¦ä½ å‘Šè¯‰æˆ‘éœ€è¦ä»€ä¹ˆæ ·ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”Ÿæˆä¸€ä¸ªä¼˜é›…ã€æ­£å¼çš„æ ¼å¼æ¨¡æ¿ã€‚
