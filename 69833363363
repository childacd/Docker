éå¸¸å¥½ï¼ä½ æé†’å¾—å¾ˆå¯¹ï¼ŒList API å…¶å®é»˜è®¤å°±å¯ä»¥åˆ—å‡ºå¯¹è±¡ï¼Œ
å¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦åŠ  --recursiveï¼Œç‰¹åˆ«æ˜¯åœ¨ MinIO å’Œ S3 ä¸­ List å‘½ä»¤ä¸ä¼šå½±å“å±‚çº§ç»“æ„ã€‚

æˆ‘å¸®ä½ æ”¹ï¼š

âœ… S3 Wrapperï¼ˆå»æ‰ recursiveï¼‰

import subprocess
from logger import logger

def is_folder(path: str) -> bool:
    return path.endswith("/")

def s3_copy(bucket, key, local_path, download=True):
    recursive_flag = " --recursive" if is_folder(key) else ""
    if download:
        cmd = f"aws s3 cp s3://{bucket}/{key} {local_path}{recursive_flag}"
        logger.info(f"Downloading from S3: {cmd}")
    else:
        cmd = f"aws s3 cp {local_path} s3://{bucket}/{key}{recursive_flag}"
        logger.info(f"Uploading to S3: {cmd}")

    subprocess.run(cmd, shell=True, check=True)

def s3_list(bucket, prefix):
    cmd = f"aws s3 ls s3://{bucket}/{prefix}"
    logger.info(f"Listing S3 objects: {cmd}")

    result = subprocess.run(cmd, shell=True, check=True, capture_output=True, text=True)
    return [line for line in result.stdout.strip().split("\n") if line]

âœ… MinIO Wrapperï¼ˆå»æ‰ recursiveï¼‰

import subprocess
from logger import logger

def is_folder(path: str) -> bool:
    return path.endswith("/")

def minio_copy(bucket, key, local_path, download=True):
    recursive_flag = " --recursive" if is_folder(key) else ""
    if download:
        cmd = f"mc cp{recursive_flag} minio/{bucket}/{key} {local_path}"
        logger.info(f"Downloading from MinIO: {cmd}")
    else:
        cmd = f"mc cp{recursive_flag} {local_path} minio/{bucket}/{key}"
        logger.info(f"Uploading to MinIO: {cmd}")

    subprocess.run(cmd, shell=True, check=True)

def minio_list(bucket, prefix):
    cmd = f"mc ls minio/{bucket}/{prefix}"
    logger.info(f"Listing MinIO objects: {cmd}")

    result = subprocess.run(cmd, shell=True, check=True, capture_output=True, text=True)
    return [line for line in result.stdout.strip().split("\n") if line]

âœ… æ ¸å¿ƒæ€»ç»“ï¼š

æ“ä½œ	æ˜¯å¦åŠ  --recursive
Copyï¼ˆSource å’Œ Destination éƒ½æ˜¯ç›®å½•æ—¶ï¼‰	âœ… åŠ 
Copyï¼ˆå•æ–‡ä»¶ï¼‰	âŒ ä¸åŠ 
Listï¼ˆä»»ä½•æƒ…å†µï¼‰	âŒ ä¸åŠ 

è¦ä¸è¦æˆ‘å¸®ä½ ï¼š
	â€¢	æ›´æ–°ä¸€ç‰ˆæ‰€æœ‰æ•´åˆåçš„å®Œæ•´ä»£ç åŒ…ç»™ä½ ï¼Ÿï¼ˆæœ€æ–°é€»è¾‘ + æœ€æ–°è§„åˆ™ï¼‰

éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ˜Š
