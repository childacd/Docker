å¥½çš„ï¼Œæˆ‘å¸®ä½ æŠŠé€»è¾‘å½»åº• ç®€åŒ–ã€æ¾„æ¸…ã€ä¸€æ­¥ä¸€æ­¥å¸¦ä½ èµ°å®Œã€‚

ä½ ç°åœ¨å·²ç»ï¼š

âœ” æˆåŠŸæŠ“åˆ°è¯ä¹¦é“¾ï¼ˆæ–¹æ³• 2ï¼‰
âœ” æœ‰ä¸€ä¸ª fullchain.pem æ–‡ä»¶

æ¥ä¸‹æ¥ä½ åªéœ€è¦æŒ‰æˆ‘ä¸‹é¢çš„æ­¥éª¤åšå³å¯ã€‚

ğŸ”¥ ç¬¬ä¸€ä»¶äº‹ï¼šä½ é—®çš„ 3 ä¸ªå…³é”®é—®é¢˜ï¼Œæˆ‘å…ˆç»Ÿä¸€å›ç­”

â“ 1. æ–¹æ³• 1ã€2ã€3ï¼Œéœ€è¦å…¨éƒ¨åšå—ï¼Ÿ

ä¸éœ€è¦ã€‚é€‰å…¶ä¸­ä¸€ä¸ªå³å¯ã€‚

ä½ å·²ç»ç”¨æ–¹æ³• 2 æŠ“åˆ°äº† â†’ ä½ ä¸éœ€è¦å†åšæ–¹æ³• 1 å’Œ 3ã€‚

â“ 2. æˆ‘åªéœ€è¦ä¸€ä¸ª .pem æ–‡ä»¶å—ï¼Ÿ

Amazon Linux éœ€è¦çš„æ˜¯ï¼š
	â€¢	å…¬å¸ Root CAï¼ˆæ ¹è¯ä¹¦ï¼‰
	â€¢	å…¬å¸ Intermediate CAï¼ˆä¸­é—´è¯ä¹¦ï¼‰ï¼ˆå¦‚æœæœ‰ï¼‰

ä½ æŠ“åˆ°çš„ fullchain.pem å¯èƒ½åŒ…å«å¤šä¸ªè¯ä¹¦ï¼Œä½ éœ€è¦ä»é‡Œé¢åˆ†ç¦»å‡ºæ­£ç¡®çš„é‚£ä¸€ä¸¤ä¸ªã€‚

â“ 3. æµè§ˆå™¨æ–¹æ³•å¾—åˆ°ä¸‰ä¸ªè¯ä¹¦ï¼Œæˆ‘åˆ°åº•è¦å“ªä¸€ä¸ªï¼Ÿ

æµè§ˆå™¨å¯¼å‡ºçš„ä¸‰ä¸ªä¸€èˆ¬å¦‚ä¸‹ï¼š

ç±»å‹	æ˜¯å¦éœ€è¦ï¼Ÿ	è¯´æ˜
Server Certificateï¼ˆæœåŠ¡å™¨è¯ä¹¦ï¼‰	âŒ ä¸éœ€è¦	è¿™æ˜¯ Nexus æœåŠ¡å™¨è‡ªå·±çš„è¯ä¹¦ï¼Œä¸éœ€è¦æ”¾å…¥ trust store
Intermediate CAï¼ˆä¸­é—´è¯ä¹¦ï¼‰	âœ… éœ€è¦	ç”¨æ¥éªŒè¯æœåŠ¡å™¨è¯ä¹¦
Root CAï¼ˆæ ¹è¯ä¹¦ï¼‰	âœ… å¿…é¡»	æ•´æ¡ä¿¡ä»»é“¾çš„æ ¹

æ‰€ä»¥ä½ è¦çš„æ˜¯ï¼š

âœ” Root CA

âœ” Intermediate CAï¼ˆå¦‚æœæœ‰ï¼‰

ğŸ”¥ ç¬¬äºŒä»¶äº‹ï¼šä½ å·²ç»æœ‰ fullchain.pemï¼Œç°åœ¨ä¸‹ä¸€æ­¥è¦åšä»€ä¹ˆï¼Ÿ

ä¸‹é¢æˆ‘æ•™ä½ ä¸€æ­¥ä¸€æ­¥æå–å’Œå®‰è£…è¯ä¹¦ã€‚

âœ… Step 1ï¼šæŠŠæŠ“åˆ°çš„ fullchain.pem åˆ†ç¦»æˆå¤šä¸ªè¯ä¹¦æ–‡ä»¶

è¿è¡Œï¼š

csplit -f cert- fullchain.pem '/-----BEGIN CERTIFICATE-----/' '{*}'

ç”Ÿæˆçš„æ–‡ä»¶ä¼šæ˜¯ï¼š

cert-00
cert-01
cert-02
...

æ¯ä¸ªæ–‡ä»¶å°±æ˜¯é“¾é‡Œçš„ä¸€ä¸ªè¯ä¹¦ã€‚

âœ… Step 2ï¼šæŸ¥çœ‹æ¯ä¸ªè¯ä¹¦æ˜¯è°ç­¾çš„ï¼ˆè¯†åˆ« root / intermediate / serverï¼‰

å¯¹æ¯ä¸ªæ–‡ä»¶æ‰§è¡Œï¼š

openssl x509 -in cert-00 -noout -text | grep -E "Issuer:|Subject:"

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ï¼š

Subject: CN=yum-cache.nomura.com
Issuer:  CN=Nomura Intermediate CA

Subject: CN=Nomura Intermediate CA
Issuer:  CN=Nomura Root CA

Subject: CN=Nomura Root CA
Issuer:  CN=Nomura Root CA

ç„¶åä½ å°±èƒ½çŸ¥é“ï¼š

æ–‡ä»¶	ç±»å‹
cert-00	Server certificateï¼ˆä¸è¦ï¼‰
cert-01	Intermediate CAï¼ˆè¦ï¼‰
cert-02	Root CAï¼ˆå¿…é¡»è¦ï¼‰

âœ… Step 3ï¼šæŠŠéœ€è¦çš„è¯ä¹¦æ–‡ä»¶å¤åˆ¶åˆ°ç³»ç»Ÿ trust store

Amazon Linux çš„ä¿¡ä»»åº“è·¯å¾„ï¼š

/etc/pki/ca-trust/source/anchors/

å°†ä¸¤ä¸ªè¯ä¹¦æ”¾è¿›å»ï¼š

sudo cp cert-01 /etc/pki/ca-trust/source/anchors/nomura-intermediate.crt
sudo cp cert-02 /etc/pki/ca-trust/source/anchors/nomura-root.crt

åå­—ä½ éšä¾¿å–ï¼Œä½†ç”¨ .crt æ›´æ¸…æ™°ã€‚

âœ… Step 4ï¼šæ›´æ–°ç³»ç»Ÿ CA ä¿¡ä»»åº“

sudo update-ca-trust

âœ… Step 5ï¼šæ¸…ç† yum ç¼“å­˜å¹¶é‡æ–°å°è¯•

sudo yum clean all
yum search rclone

å¦‚æœä½ çš„ CA æ­£å¸¸å¯¼å…¥ï¼ŒSSL é”™è¯¯ä¼šæ¶ˆå¤±ã€‚

ğŸ”¥ å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç›´æ¥å¸®ä½ åˆ¤æ–­å“ªä¸ª cert æ˜¯ root / intermediate

ä½ åªéœ€è¦æŠŠä»¥ä¸‹å†…å®¹è´´ç»™æˆ‘ï¼ˆä¸éœ€è¦å…¨éƒ¨è¯ä¹¦å†…å®¹ï¼Œåªè¦ Issuer / Subject å³å¯ï¼‰ï¼š

æ‰§è¡Œï¼š

openssl x509 -in cert-00 -noout -text | grep -E "Issuer:|Subject:"
openssl x509 -in cert-01 -noout -text | grep -E "Issuer:|Subject:"
openssl x509 -in cert-02 -noout -text | grep -E "Issuer:|Subject:"

æŠŠè¾“å‡ºè´´ç»™æˆ‘ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ ï¼š
	â€¢	å“ªä¸ªæ˜¯ root
	â€¢	å“ªä¸ªæ˜¯ intermediate
	â€¢	å“ªäº›éœ€è¦å¯¼å…¥
	â€¢	å“ªäº›ä¸éœ€è¦

ä½ ç°åœ¨æŠ“åˆ°çš„è¯ä¹¦é“¾æˆ‘å¯ä»¥å®Œæ•´å¸®ä½ å¤„ç†ã€‚
