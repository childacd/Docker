å¥½ ğŸ‘
ä¸‹é¢æ˜¯ä¸€å¥— ã€Œç›´æ¥ copy å°±èƒ½è·‘ã€çš„æœ€å°å¯ç”¨ ServiceNow Agent å·¥å…·åŒ…ï¼Œä¸“é—¨ä¸ºï¼š
	â€¢	âœ… Python é¡¹ç›®
	â€¢	âœ… VS Code + Copilot Agent
	â€¢	âœ… é€šè¿‡ Makefile ä½œä¸ºå®‰å…¨å…¥å£
	â€¢	âœ… Bearer Tokenï¼ˆä¹Ÿæ”¯æŒ basicï¼Œå…ˆç»™ä½  token ç‰ˆï¼‰

ä½ å¯ä»¥ä¸€è‚¡è„‘å…¨å¤åˆ¶ï¼ŒæŒ‰é¡ºåºæ”¾æ–‡ä»¶ã€‚

ä¸€ã€ç›®å½•ç»“æ„ï¼ˆç…§ç€å»ºï¼‰

repo/
â”œâ”€ tools/
â”‚  â””â”€ servicenow/
â”‚     â”œâ”€ __init__.py
â”‚     â”œâ”€ client.py
â”‚     â”œâ”€ ritm.py
â”‚     â””â”€ cli.py
â”œâ”€ Makefile
â”œâ”€ .env.example
â””â”€ .gitignore

äºŒã€.env.example

	âœ… æä¾›å˜é‡å
âŒ ä¸æ”¾çœŸå® token

SN_INSTANCE=https://your-instance.service-now.com
SN_TOKEN=

ä½ æœ¬åœ°å†å»ºä¸€ä¸ª .envï¼ˆä¸è¦æäº¤ï¼‰ï¼š

SN_INSTANCE=https://xxx.service-now.com
SN_TOKEN=your_real_token_here

ä¸‰ã€.gitignore

.env
__pycache__/

å››ã€ServiceNow clientï¼ˆæ ¸å¿ƒï¼šé‰´æƒ / timeout / retryï¼‰

ğŸ“„ tools/servicenow/client.py

import os
import time
import requests

SN_INSTANCE = os.getenv("SN_INSTANCE")
SN_TOKEN = os.getenv("SN_TOKEN")

if not SN_INSTANCE:
    raise RuntimeError("SN_INSTANCE not set")

HEADERS = {
    "Accept": "application/json",
    "Content-Type": "application/json",
}

if SN_TOKEN:
    HEADERS["Authorization"] = f"Bearer {SN_TOKEN}"


def request(method, path, *, params=None, json=None, retries=3, timeout=10):
    url = f"{SN_INSTANCE}{path}"

    for attempt in range(1, retries + 1):
        resp = requests.request(
            method,
            url,
            headers=HEADERS,
            params=params,
            json=json,
            timeout=timeout,
        )

        if resp.status_code < 400:
            return resp.json()

        # retry on rate limit / server error
        if resp.status_code in (429, 500, 502, 503):
            time.sleep(attempt)
            continue

        raise RuntimeError(
            f"ServiceNow error {resp.status_code}: {resp.text}"
        )

    raise RuntimeError("ServiceNow request failed after retries")

äº”ã€RITM é«˜å±‚å°è£…

ğŸ“„ tools/servicenow/ritm.py

from .client import request


def get_ritm(number: str):
    data = request(
        "GET",
        "/api/now/table/sc_req_item",
        params={"sysparm_query": f"number={number}"},
    )

    results = data.get("result", [])
    if not results:
        raise RuntimeError(f"RITM {number} not found")

    return results[0]


def add_comment(number: str, text: str):
    ritm = get_ritm(number)
    sys_id = ritm["sys_id"]

    return request(
        "PATCH",
        f"/api/now/table/sc_req_item/{sys_id}",
        json={"comments": text},
    )

å…­ã€CLI å…¥å£ï¼ˆAgent åªè·‘è¿™ä¸ªï¼‰

ğŸ“„ tools/servicenow/cli.py

import argparse
import json
from dotenv import load_dotenv

from .ritm import get_ritm, add_comment


def main():
    load_dotenv()

    parser = argparse.ArgumentParser("servicenow-cli")
    sub = parser.add_subparsers(dest="cmd", required=True)

    ritm = sub.add_parser("ritm")
    ritm_sub = ritm.add_subparsers(dest="action", required=True)

    get_cmd = ritm_sub.add_parser("get")
    get_cmd.add_argument("--number", required=True)

    comment_cmd = ritm_sub.add_parser("comment")
    comment_cmd.add_argument("--number", required=True)
    comment_cmd.add_argument("--text", required=True)

    args = parser.parse_args()

    if args.cmd == "ritm" and args.action == "get":
        result = get_ritm(args.number)
        print(json.dumps(result, indent=2))

    if args.cmd == "ritm" and args.action == "comment":
        result = add_comment(args.number, args.text)
        print(json.dumps(result, indent=2))


if __name__ == "__main__":
    main()

ä¸ƒã€Makefileï¼ˆç»™ Agent çš„â€œå”¯ä¸€å…¥å£â€ï¼‰

ğŸ“„ Makefile

	âš ï¸ æ³¨æ„ï¼šå‘½ä»¤å‰æ˜¯ Tabï¼Œä¸æ˜¯ç©ºæ ¼

sn-ritm:
\tpython -m tools.servicenow.cli ritm get --number "$(n)"

sn-comment:
\tpython -m tools.servicenow.cli ritm comment --number "$(n)" --text "$(t)"

å…«ã€ä½ ç°åœ¨å¯ä»¥æ€ä¹ˆç”¨ï¼ˆäºº & Agent éƒ½ä¸€æ ·ï¼‰

1ï¸âƒ£ æœ¬åœ°æµ‹è¯•ï¼ˆäººï¼‰

make sn-ritm n=RITM123456

make sn-comment n=RITM123456 t="Checked by automation"

2ï¸âƒ£ ç»™ Copilot Agent çš„æŒ‡ä»¤ï¼ˆæ¨èç›´æ¥å¤åˆ¶ï¼‰

å¦‚æœéœ€è¦æŸ¥è¯¢æˆ–æ›´æ–° ServiceNow RITMï¼Œ
åªèƒ½ä½¿ç”¨ Makefile æä¾›çš„å‘½ä»¤ï¼š
- make sn-ritm
- make sn-comment

ä¸è¦ç›´æ¥è°ƒç”¨ ServiceNow APIã€‚

ä¹‹åä½ åªéœ€è¦ Approve make sn-ritm / make sn-commentã€‚

ä¹ã€ä¸ºä»€ä¹ˆè¿™å¥—éå¸¸é€‚åˆ Agentï¼ˆæ€»ç»“ï¼‰
	â€¢	ğŸ” token æ°¸è¿œåœ¨ .env
	â€¢	ğŸšª Agent åªèƒ½èµ° Makefile
	â€¢	ğŸ§  è¾“å‡ºæ˜¯ JSONï¼ŒAgent å¾ˆå¥½ç†è§£
	â€¢	ğŸ” retry / timeout å·²å¤„ç†
	â€¢	ğŸ“ˆ ä½ ä»¥ååŠ ï¼š
	â€¢	update state
	â€¢	assign group
	â€¢	attach file
åªéœ€è¦åŠ ä¸€ä¸ªå‡½æ•° + ä¸€ä¸ª make target

å¦‚æœä½ ä¸‹ä¸€æ­¥æƒ³è¦ï¼š
	â€¢	æ”¯æŒ basic auth
	â€¢	æ”¯æŒ update state / assignment_group
	â€¢	æŠŠ response å­˜ .artifacts/ ä¾› Agent å¯¹æ¯”
	â€¢	æˆ–è€…å¯¹æ¥ä½ ç°åœ¨ ServiceNow copy job / RITM è‡ªåŠ¨åŒ–æµç¨‹

ä½ ç›´æ¥è·Ÿæˆ‘è¯´ä½ ä¸‹ä¸€æ­¥è¦â€œå¹²å•¥â€ï¼Œæˆ‘å¸®ä½ åœ¨è¿™å¥—åŸºç¡€ä¸Šç»§ç»­æ‰©ã€‚
