æ²¡é—®é¢˜ï¼Œæˆ‘ç°åœ¨å¸®ä½ æŠŠæ•´ä¸ªåŠŸèƒ½ ä¸€æ¬¡æ€§ä¸²èµ·æ¥ï¼š
	1.	æå–å¤šä¸ª JSON å¯¹è±¡
	2.	å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆä½äºå½“å‰ Python è„šæœ¬åŒçº§ç›®å½•ï¼‰
	3.	è°ƒç”¨å¦ä¸€ä¸ª Python è„šæœ¬ï¼Œå¹¶æŠŠè¿™ä¸ªä¸´æ—¶æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ è¿›å»
	4.	ä½ å¯ä»¥è‡ªå·±æ›¿æ¢ Dummy çš„å…¶å®ƒå‚æ•°

æˆ‘ä¼šç»™ä½ ä¸€ä¸ª å®Œæ•´å¯ç›´æ¥å¤åˆ¶è¿è¡Œ çš„ç‰ˆæœ¬ã€‚

âœ… ä½ æœ€ç»ˆä¼šå¾—åˆ°çš„ç›®å½•ç»“æ„ï¼ˆç¤ºä¾‹ï¼‰

your_project/
    poll.py               â† ä½ å½“å‰çš„è½®è¯¢è„šæœ¬
    worker.py             â† ä½ è¦è°ƒç”¨çš„å¦ä¸€ä¸ªè„šæœ¬
    tmp_requests_xxxxx.json  â† è‡ªåŠ¨ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶

âœ¨ Step 1 â€” å†™ä¸€ä¸ªå‡½æ•°ï¼šæŠŠ extracted JSON list å†™å…¥ temp æ–‡ä»¶

âœ” å†™å…¥æ–‡ä»¶æ ¼å¼ï¼šæ ‡å‡† JSON array

ï¼ˆè¿™æ · worker.py å¯ä»¥æ–¹ä¾¿è¯»å–ï¼‰

æˆ‘ç»™ä½ å†™ï¼šwrite_temp_json_file(json_data)
è¿”å›æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºä¸‹ä¸€æ­¥è°ƒç”¨è„šæœ¬ã€‚

import json
import os
import uuid

def write_temp_json_file(json_data):
    """
    Write extracted JSON objects into a temporary file
    located in the same directory as the current script.
    Returns the file path.
    """
    filename = f"tmp_requests_{uuid.uuid4().hex}.json"
    filepath = os.path.join(os.path.dirname(__file__), filename)

    with open(filepath, "w", encoding="utf-8") as f:
        json.dump(json_data, f, indent=4)

    print(f"[Temp File Created] {filepath}")
    return filepath

âœ¨ Step 2 â€” è°ƒç”¨å¦ä¸€ä¸ª Python è„šæœ¬ï¼ˆworker.pyï¼‰

æˆ‘å‡è®¾ä½ è¦è¿è¡Œçš„è„šæœ¬æ˜¯ï¼š

python worker.py --input <temp_file> --env dev --retry 3

ä½ å¯ä»¥ç”¨ subprocess.run()ï¼š

import subprocess

def run_worker_script(input_file_path):
    """
    Call worker.py with the extracted temp file and some dummy arguments.
    """
    cmd = [
        "python",
        "worker.py",            # your other script
        "--input", input_file_path,
        "--env", "dev",         # dummy arg
        "--retry", "3"          # dummy arg
    ]

    print("[Running Worker Script] ", " ".join(cmd))

    result = subprocess.run(
        cmd,
        capture_output=True,
        text=True
    )

    print("[Worker Output]")
    print(result.stdout)
    if result.stderr:
        print("[Worker Errors]")
        print(result.stderr)

åç»­ä½ è‡ªå·±æŠŠ "--env" "dev" "--retry" 3" æ¢æˆä½ éœ€è¦çš„å°±å¯ä»¥ã€‚

âœ¨ Step 3 â€” åœ¨è½®è¯¢çš„é€»è¾‘é‡ŒåŠ å…¥è¿™ä¸¤æ­¥

æˆ‘ç»™ä½ ä¸€ä¸ªæ•´åˆåˆ° poll å†…éƒ¨çš„ä»£ç æ®µï¼š

for item in data:
    description = item.get("description") or ""
    section = extract_json_section(description)
    requests_json = extract_json_objects(section)

    print("Parsed JSON requests:", requests_json)

    if requests_json:
        # Step 1: write JSON to temp file
        temp_file = write_temp_json_file(requests_json)

        # Step 2: call worker script
        run_worker_script(temp_file)

å½“ä½ çš„ ServiceNow é‡Œå‡ºç°æ–°çš„ RITM â†’
ä½ çš„è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
	1.	æ•è· JSON array
	2.	å†™å…¥ temp æ–‡ä»¶
	3.	è°ƒç”¨ worker.py + æŠŠ temp æ–‡ä»¶ä½œä¸ºå‚æ•°

ğŸ‰ ä¸‹é¢ç»™ä½ ä¸€ä¸ªæœ€ç»ˆâ€œæ•´åˆç‰ˆæœ¬â€ç‰‡æ®µï¼ˆä½ ç›´æ¥å¤åˆ¶å³å¯ï¼‰

import os
import uuid
import json
import subprocess

def write_temp_json_file(json_data):
    filename = f"tmp_requests_{uuid.uuid4().hex}.json"
    filepath = os.path.join(os.path.dirname(__file__), filename)

    with open(filepath, "w", encoding="utf-8") as f:
        json.dump(json_data, f, indent=4)

    print(f"[Temp File Created] {filepath}")
    return filepath


def run_worker_script(input_file_path):
    cmd = [
        "python",
        "worker.py",            # another python script
        "--input", input_file_path,
        "--env", "dev",         # dummy param
        "--retry", "3"          # dummy param
    ]

    print("[Running Worker Script] ", " ".join(cmd))

    result = subprocess.run(
        cmd,
        capture_output=True,
        text=True
    )

    print("[Worker Output]")
    print(result.stdout)

    if result.stderr:
        print("[Worker Errors]")
        print(result.stderr)

ç„¶ååœ¨ä½ çš„è½®è¯¢è„šæœ¬é‡ŒåŠ å…¥ï¼š

json_list = extract_json_objects(section)

if json_list:
    temp_file = write_temp_json_file(json_list)
    run_worker_script(temp_file)

âœ” ä½ ç°åœ¨å¯ä»¥æµ‹è¯•å®Œæ•´æµç¨‹ï¼š
	1.	åœ¨ SN æ–°å»ºä¸€ä¸ª RITM
	2.	description é‡Œå†™

JSON Array of requests: {â€¦}, {â€¦}, ...


	3.	è½®è¯¢è„šæœ¬ä¼šç«‹å³æ•è·
	4.	è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª tmp_requests_xxxx.json
	5.	è‡ªåŠ¨è°ƒç”¨ä½ çš„ worker.py

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘è¿˜å¯ä»¥å¸®ä½ ï¼š
	â€¢	è‡ªåŠ¨æŠŠ tmp æ–‡ä»¶å¤„ç†ååˆ é™¤
	â€¢	ç»™ temp æ–‡ä»¶åŠ  timestamp å‘½åè§„åˆ™
	â€¢	æ”¹æˆ Linux æœåŠ¡ï¼ˆsystemdï¼‰é•¿æœŸåå°è¿è¡Œ
	â€¢	æ”¹æˆ Windows æœåŠ¡
	â€¢	æˆ–è€…æ”¹æˆ Docker å®¹å™¨

ä½ ç°åœ¨æƒ³è¿›ä¸€æ­¥æ‰©å±•å“ªä¸€å—ï¼Ÿ
