å¤ªå¥½äº†ï¼Œæˆ‘ä¾†è©³ç´°èªªæ˜ä½ æåˆ°çš„å…©å€‹æ–¹å‘ï¼š

âœ… æ–¹æ³• 3ï¼šä½¿ç”¨ Bucket Policy ç¦æ­¢å¯«å…¥æŸå€‹è³‡æ–™å¤¾ï¼ˆPrefixï¼‰

é€™å€‹æ–¹æ³•æ˜¯åœ¨ bucket å±¤ç´š åšé™åˆ¶ï¼Œæœƒå½±éŸ¿æ‰€æœ‰äººï¼ˆæ‰€æœ‰ user/groupï¼‰ï¼Œä¹Ÿå°±æ˜¯å…¨å±€çš„ Denyã€‚

ğŸ¯ ç›®æ¨™ç¯„ä¾‹ï¼š

	ç¦æ­¢æ‰€æœ‰äººå¾€ mybucket/secret-folder/ ä¸Šå‚³ï¼ˆPutObjectï¼‰

âœ… ç¬¬ä¸€æ­¥ï¼šæº–å‚™ Bucket Policy JSON

ä½ å¯ä»¥å¯«ä¸€å€‹æ˜ç¢ºçš„ Deny policyï¼Œå¦‚ä¸‹ï¼š

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyUploadToSecretFolder",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::mybucket/secret-folder/*"
    }
  ]
}

é€™è¡¨ç¤ºï¼š
	â€¢	Effect: Denyï¼šæ˜ç¢ºæ‹’çµ•
	â€¢	Principal: "*"ï¼šæ‹’çµ•æ‰€æœ‰äººï¼ˆuser æˆ– groupï¼‰
	â€¢	Action: s3:PutObjectï¼šæ‹’çµ•ä¸Šå‚³æª”æ¡ˆ
	â€¢	Resource: arn:aws:s3:::mybucket/secret-folder/*ï¼šé‡å°é€™å€‹ prefix

âœ… ç¬¬äºŒæ­¥ï¼šå¥—ç”¨é€™æ¢ Bucket Policy

ç”¨ mc æŒ‡ä»¤æŠŠ policy å¥—ç”¨ä¸Šå»ï¼š

mc alias set minio http://<your-minio-host>:9000 <access-key> <secret-key>

mc admin policy set-json deny-secret-folder.json --name deny-secret-folder --alias minio

mc admin bucket policy set minio/mybucket deny-secret-folder

æˆ–è€…æ›´ç›´æ¥ï¼š

mc ilm import minio/mybucket < deny-secret-folder.json

ï¼ˆè¦–ä½  MinIO ç‰ˆæœ¬è€Œå®šï¼Œå»ºè­°ç”¨ mc admin bucket policy é€™å¥—ï¼‰

âœ… é©—è­‰

ä½ å¯ä»¥å˜—è©¦ï¼š

mc cp somefile.txt minio/mybucket/secret-folder/

æ‡‰è©²æœƒå‡ºç¾é¡ä¼¼ã€ŒAccess Deniedã€çš„éŒ¯èª¤ã€‚

âœ… å˜—è©¦ç‚ºæŸå€‹ä½¿ç”¨è€… attach ä¸€å€‹â€œç¦æ­¢å¯«å…¥â€çš„ policy

é›–ç„¶å‰é¢èªªæ˜é MinIO æ˜¯ â€œmost permissive winsâ€ï¼Œä¸éé‚„æ˜¯å¯ä»¥è©¦è©¦ä»¥ä¸‹æ­¥é©Ÿï¼ˆç•¶æ¸¬è©¦æˆ–å–®ç´”ç‚ºäº†æ•™è‚²ç›®çš„æ™‚æ˜¯åˆç†çš„ï¼‰ã€‚

â— é‡è¦æé†’ï¼š

	åœ¨ MinIO ä¸­ï¼ŒDeny ä¸æœƒ override Allowï¼Œæ‰€ä»¥å¦‚æœè©² user å±¬æ–¼ä¸€å€‹æœ‰ write æ¬Šé™çš„ groupï¼Œé€™å€‹ Deny policy ç„¡æ•ˆã€‚

âœ… Policy JSONï¼šæ‹’çµ•ç‰¹å®šè³‡æ–™å¤¾ä¸Šå‚³

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyPutSecretFolder",
      "Effect": "Deny",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::mybucket/secret-folder/*"
    }
  ]
}

å„²å­˜ç‚º deny-upload.jsonã€‚

âœ… å¥—ç”¨æ­¥é©Ÿ
	1.	å»ºç«‹ policyï¼š

mc admin policy add minio deny-upload deny-upload.json

	2.	ç¶å®šçµ¦ä½¿ç”¨è€…ï¼š

mc admin policy set minio user=<your-username> policy=deny-upload

âœ… é©—è­‰çµæœ

ä½ å¯ä»¥ç”¨é€™å€‹ user å˜—è©¦ï¼š

mc cp test.txt minio/mybucket/secret-folder/

ä½ æœƒç™¼ç¾ï¼š
	â€¢	å¦‚æœé€™å€‹ user æ²’æœ‰å…¶ä»– group æˆ–å…¶ä»– policy å¯ä»¥å¯«å…¥è©²ç›®éŒ„ï¼Œå‰‡æœƒ Access Denied
	â€¢	å¦‚æœé€™å€‹ user å±¬æ–¼å…è¨±å¯«çš„ groupï¼Œé‚„æ˜¯å¯ä»¥å¯«å…¥ï¼ˆMinIO çš„ most-permissive è¨­è¨ˆï¼‰

âœ… æœ€å¾Œå»ºè­°
	â€¢	âŒ MinIO æ²’æœ‰ IAM-style explicit deny çš„å¼·åˆ¶å„ªå…ˆæ¬Šï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ deny è¦†è“‹ group çš„ allowã€‚
	â€¢	âœ… å»ºè­°ç”¨ bucket policy ä¾†é™åˆ¶æ•´å€‹ prefix çš„è¡Œç‚ºã€‚
	â€¢	âœ… æˆ–è€…åœ¨æ¬Šé™è¦åŠƒæ™‚ï¼Œåˆ†çµ„æ›´ç´°ç²’åº¦æ§åˆ¶ï¼Œä¸è®“ user åŠ å…¥éæ–¼å¯¬é¬†çš„ groupã€‚

éœ€è¦çš„è©±ï¼Œæˆ‘å¯ä»¥å¹«ä½ å¯«ä¸€æ•´å¥— user policy + bucket policy æ¸¬è©¦æµç¨‹æˆ–è‡ªå‹•åŒ–è…³æœ¬ã€‚è¦ä¸è¦ï¼Ÿ
